

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: Player.js | Ranvier</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
        
            <link type="text/css" rel="stylesheet" href="../../assets/stylesheets/srcdocs.css">
        
            <link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans|PT+Mono|Material+Icons|Fugaz+One">
        
    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 120px; height: 120px">
        <img src="../images/logo.png" width="100%" height="100%">
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Ranvier</a></h1>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
    <div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="BehaviorManager.html">BehaviorManager</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BehaviorManager_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="BehaviorManager.html#addListener">addListener</a></li><li><a href="BehaviorManager.html#get">get</a></li><li><a href="BehaviorManager.html#has">has</a></li></ul></div></li><li><a href="Channel.html">Channel</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Channel_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Channel.html#formatToReceipient">formatToReceipient</a></li><li><a href="Channel.html#formatToSender">formatToSender</a></li><li><a href="Channel.html#send">send</a></li></ul></div></li><li><a href="Character.html">Character</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Character_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Character.html#addCombatant">addCombatant</a></li><li><a href="Character.html#calculateWeaponDamage">calculateWeaponDamage</a></li><li><a href="Character.html#emit">emit</a></li><li><a href="Character.html#evaluateIncomingDamage">evaluateIncomingDamage</a></li><li><a href="Character.html#evaluateOutgoingDamage">evaluateOutgoingDamage</a></li><li><a href="Character.html#findCombatant">findCombatant</a></li><li><a href="Character.html#getMaxAttribute">getMaxAttribute</a></li><li><a href="Character.html#initiateCombat">initiateCombat</a></li><li><a href="Character.html#isInCombat">isInCombat</a></li><li><a href="Character.html#normalizeWeaponDamage">normalizeWeaponDamage</a></li><li><a href="Character.html#removeCombatant">removeCombatant</a></li><li><a href="Character.html#removeFromCombat">removeFromCombat</a></li><li><a href="Character.html#serialize">serialize</a></li></ul></div></li><li><a href="ClassManager.html">ClassManager</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ClassManager_sub"></div></li><li><a href="Command.html">Command</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Command_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Command.html#execute">execute</a></li></ul></div></li><li><a href="CommandParser.html">CommandParser</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="CommandParser_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="CommandParser.html#.parse">parse</a></li><li><a href="CommandParser.html#.parseDot">parseDot</a></li></ul></div></li><li><a href="Damage.html">Damage</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Damage_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Damage.html#commit">commit</a></li><li><a href="Damage.html#evaluate">evaluate</a></li></ul></div></li><li><a href="Effect.html">Effect</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Effect_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Effect.html#elapsed">elapsed</a></li><li><a href="Effect.html#remaining">remaining</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Effect.html#modifyAttribute">modifyAttribute</a></li><li><a href="Effect.html#modifyIncomingDamage">modifyIncomingDamage</a></li><li><a href="Effect.html#modifyOutgoingDamage">modifyOutgoingDamage</a></li><li><a href="Effect.html#remove">remove</a></li></ul></div></li><li><a href="EffectFactory.html">EffectFactory</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="EffectFactory_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="EffectFactory.html#add">add</a></li><li><a href="EffectFactory.html#create">create</a></li><li><a href="EffectFactory.html#get">get</a></li></ul></div></li><li><a href="EffectList.html">EffectList</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="EffectList_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="EffectList.html#add">add</a></li><li><a href="EffectList.html#emit">emit</a></li><li><a href="EffectList.html#entries">entries</a></li><li><a href="EffectList.html#evaluateAttribute">evaluateAttribute</a></li><li><a href="EffectList.html#evaluateIncomingDamage">evaluateIncomingDamage</a></li><li><a href="EffectList.html#evaluateOutgoingDamage">evaluateOutgoingDamage</a></li><li><a href="EffectList.html#remove">remove</a></li><li><a href="EffectList.html#validateEffects">validateEffects</a></li></ul></div></li><li><a href="EntityFactory.html">EntityFactory</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="EntityFactory_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="EntityFactory.html#addScriptListener">addScriptListener</a></li><li><a href="EntityFactory.html#clone">clone</a></li><li><a href="EntityFactory.html#createByType">createByType</a></li><li><a href="EntityFactory.html#createEntityRef">createEntityRef</a></li><li><a href="EntityFactory.html#getDefinition">getDefinition</a></li><li><a href="EntityFactory.html#setDefinition">setDefinition</a></li></ul></div></li><li><a href="EventManager.html">EventManager</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="EventManager_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="EventManager.html#add">add</a></li><li><a href="EventManager.html#attach">attach</a></li><li><a href="EventManager.html#detach">detach</a></li><li><a href="EventManager.html#get">get</a></li></ul></div></li><li><a href="Item.html">Item</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Item_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Item.html#display">display</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Item.html#findOwner">findOwner</a></li><li><a href="Item.html#getBehavior">getBehavior</a></li><li><a href="Item.html#hasBehavior">hasBehavior</a></li><li><a href="Item.html#qualityColorize">qualityColorize</a></li></ul></div></li><li><a href="ItemFactory.html">ItemFactory</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ItemFactory_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="ItemFactory.html#create">create</a></li></ul></div></li><li><a href="MobFactory.html">MobFactory</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="MobFactory_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="MobFactory.html#create">create</a></li></ul></div></li><li><a href="Npc.html">Npc</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Npc_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Npc.html#getBehavior">getBehavior</a></li><li><a href="Npc.html#hasBehavior">hasBehavior</a></li><li><a href="Npc.html#moveTo">moveTo</a></li></ul></div></li><li><a href="Party.html">Party</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Party_sub"></div></li><li><a href="Player.html">Player</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Player_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Player.html#addPrompt">addPrompt</a></li><li><a href="Player.html#canGo">canGo</a></li><li><a href="Player.html#emit">emit</a></li><li><a href="Player.html#getBroadcastTargets">getBroadcastTargets</a></li><li><a href="Player.html#getMeta">getMeta</a></li><li><a href="Player.html#hasPrompt">hasPrompt</a></li><li><a href="Player.html#interpolatePrompt">interpolatePrompt</a></li><li><a href="Player.html#moveTo">moveTo</a></li><li><a href="Player.html#queueCommand">queueCommand</a></li><li><a href="Player.html#removePrompt">removePrompt</a></li><li><a href="Player.html#setMeta">setMeta</a></li></ul></div></li><li><a href="PlayerClass.html">PlayerClass</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="PlayerClass_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="PlayerClass.html#abilityTable">abilityTable</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="PlayerClass.html#canUseAbility">canUseAbility</a></li><li><a href="PlayerClass.html#getAbilitiesForPlayer">getAbilitiesForPlayer</a></li><li><a href="PlayerClass.html#setupPlayer">setupPlayer</a></li></ul></div></li><li><a href="Quest.html">Quest</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Quest_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Quest.html#emit">emit</a></li><li><a href="Quest.html#getProgress">getProgress</a></li></ul></div></li><li><a href="QuestFactory.html">QuestFactory</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="QuestFactory_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="QuestFactory.html#_makeQuestKey">_makeQuestKey</a></li><li><a href="QuestFactory.html#create">create</a></li><li><a href="QuestFactory.html#get">get</a></li></ul></div></li><li><a href="QuestTracker.html">QuestTracker</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="QuestTracker_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="QuestTracker.html#canStart">canStart</a></li><li><a href="QuestTracker.html#complete">complete</a></li><li><a href="QuestTracker.html#emit">emit</a></li><li><a href="QuestTracker.html#hydrate">hydrate</a></li><li><a href="QuestTracker.html#isActive">isActive</a></li><li><a href="QuestTracker.html#isComplete">isComplete</a></li><li><a href="QuestTracker.html#serialize">serialize</a></li><li><a href="QuestTracker.html#start">start</a></li></ul></div></li><li><a href="Room.html">Room</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Room_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Room.html#spawnedNpcs">spawnedNpcs</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Room.html#emit">emit</a></li><li><a href="Room.html#getBehavior">getBehavior</a></li><li><a href="Room.html#getBroadcastTargets">getBroadcastTargets</a></li><li><a href="Room.html#hasBehavior">hasBehavior</a></li></ul></div></li><li><a href="Skill.html">Skill</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Skill_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Skill.html#cooldown">cooldown</a></li><li><a href="Skill.html#execute">execute</a></li><li><a href="Skill.html#onCooldown">onCooldown</a></li><li><a href="Skill.html#payResourceCosts">payResourceCosts</a></li><li><a href="Skill.html#searchForTargets">searchForTargets</a></li></ul></div></li><li><a href="TelnetServer.html">TelnetServer</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="TelnetServer_sub"></div></li><li><a href="TelnetStream.html">TelnetStream</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="TelnetStream_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="TelnetStream.html#input">input</a></li><li><a href="TelnetStream.html#telnetCommand">telnetCommand</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Global</h3><ul><li><a href="global.html#baseAttributeByLevel">baseAttributeByLevel</a></li><li><a href="global.html#diff">diff</a></li><li><a href="global.html#EffectConfig">EffectConfig</a></li><li class="hidden"><a href="global.html#EffectModifiers">EffectModifiers</a></li><li><a href="global.html#expToLevel">expToLevel</a></li><li><a href="global.html#genWrite">genWrite</a></li><li><a href="global.html#HealthPerStaminaTable">HealthPerStaminaTable</a></li><li><a href="global.html#mobExp">mobExp</a></li><li><a href="global.html#reduction">reduction</a></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

const Attributes = require('./Attributes');
const Character = require('./Character');
const CommandQueue = require('./CommandQueue');
const Config = require('./Config');
const Data = require('./Data');
const QuestTracker = require('./QuestTracker');
const Room = require('./Room');
const Logger = require('./Logger');
const PlayerRoles = require('./PlayerRoles');

/**
 * @property {Account} account
 * @property {number}  experience current experience this level
 * @property {string}  password
 * @property {string}  prompt     default prompt string
 * @property {net.Socket} socket
 * @property {QuestTracker} questTracker
 * @property {Map&lt;string,function ()>} extraPrompts Extra prompts to render after the default prompt
 * @property {{completed: Array, active: Array}} questData
 */
class Player extends Character {
  constructor(data) {
    super(data);

    this.account = data.account || null;
    this.experience = data.experience || 0;
    this.extraPrompts = new Map();
    this.password  = data.password;
    this.playerClass = null;
    this.prompt = data.prompt || '[ %health.current%/%health.max% &lt;bold>hp&lt;/bold> ]';
    this.socket = data.socket || null;
    const questData = Object.assign({
      completed: [],
      active: []
    }, data.quests);

    this.questTracker = new QuestTracker(this, questData.active, questData.completed);
    this.commandQueue = new CommandQueue();
    this.role = data.role || PlayerRoles.PLAYER;

    // Arbitrary data bundles are free to shove whatever they want in
    // WARNING: values must be JSON.stringify-able
    this.metadata = data.metadata || {};
    this.playerClass = null;

    // Default max inventory size config
    if (!isFinite(this.inventory.getMax())) {
      this.inventory.setMax(Config.get('defaultMaxPlayerInventory') || 20);
    }
  }

  /**
   * Set a metadata value. Does _not_ autovivify, you will need to create the parent objects if they don't exist
   * @param {string} key   Key to set. Supports dot notation e.g., `"foo.bar"`
   * @param {*}      value Value must be JSON.stringify-able
   */
  setMeta(key, value) {
    let parts = key.split('.');
    const property = parts.pop();
    let base = this.metadata;

    while (parts.length) {
      let part = parts.pop();
      if (!(part in base)) {
        throw new RangeError(`Metadata path invalid: ${key}`);
      }
      base = base[part];
    }

    base[property] = value;
  }

  /**
   * Get metadata about a player
   * @param {string} key Key to fetch. Supports dot notation e.g., `"foo.bar"`
   * @return {*}
   */
  getMeta(key) {
    let base = this.metadata;
    return key.split('.').reduce((obj, index) => obj &amp;&amp; obj[index], base);
  }

  /**
   * @see CommandQueue::enqueue
   */
  queueCommand(executable, lag) {
    const index = this.commandQueue.enqueue(executable, lag);
    this.emit('commandQueued', index);
  }

  /**
   * Proxy all events on the player to the quest tracker
   * @param {string} event
   * @param {...*}   args
   */
  emit(event, ...args) {
    super.emit(event, ...args);

    this.questTracker.emit(event, ...args);
  }

  /**
   * Convert prompt tokens into actual data
   * @param {string} promptStr
   * @param {object} extraData Any extra data to give the prompt access to
   */
  interpolatePrompt(promptStr, extraData = {}) {
    let attributeData = {};
    for (const [attr, value] of this.attributes) {
      attributeData[attr] = {
        current: this.getAttribute(attr),
        max: this.getMaxAttribute(attr),
        base: this.getBaseAttribute(attr),
      };
    }
    const promptData = Object.assign(attributeData, extraData);

    let matches = null;
    while (matches = promptStr.match(/%([a-z\.]+)%/)) {
      const token = matches[1];
      var promptValue = token.split('.').reduce((obj, index) => obj &amp;&amp; obj[index], promptData);
      if (promptValue === null || promptValue === undefined) {
        promptValue = 'invalid-token';
      }
      promptStr = promptStr.replace(matches[0], promptValue);
    }

    return promptStr;
  }

  /**
   * Add a line of text to be displayed immediately after the prompt when the prompt is displayed
   * @param {string}      id       Unique prompt id
   * @param {function ()} renderer Function to call to render the prompt string
   * @param {?boolean}    removeOnRender When true prompt will remove itself once rendered
   *    otherwise prompt will continue to be rendered until removed.
   */
  addPrompt(id, renderer, removeOnRender = false) {
    this.extraPrompts.set(id, { removeOnRender, renderer });
  }

  /**
   * @param {string} id
   */
  removePrompt(id) {
    this.extraPrompts.delete(id);
  }

  /**
   * @param {string} id
   * @return {boolean}
   */
  hasPrompt(id) {
    return this.extraPrompts.has(id);
  }

  /**
   * Move the player to the given room, emitting events appropriately
   * @param {Room} nextRoom
   * @param {function} onMoved Function to run after the player is moved to the next room but before enter events are fired
   */
  moveTo(nextRoom, onMoved = _ => _) {
    if (this.room) {
      this.room.emit('playerLeave', this, nextRoom);
      this.room.removePlayer(this);
    }

    this.room = nextRoom;
    nextRoom.addPlayer(this);

    onMoved();

    nextRoom.emit('playerEnter', this);
    this.emit('enterRoom', nextRoom);
  }

  /**
   * Determine if a player can leave the current room to a given direction
   * TODO: This shouldn't be here but there's not better place at the moment
   * @param {string} direction
   * @return {boolean}
   */
  canGo(direction) {
    if (!this.room) {
      return false;
    }

    const exits = Array.from(this.room.exits).filter(e => e.direction.indexOf(direction) === 0);

    if (!exits.length) {
      return false;
    }

    if (exits.length > 1) {
      return false;
    }

    if (this.isInCombat()) {
      return false;
    }

    return true;
  }

  save(callback) {
    Data.save('player', this.name, this.serialize(), callback);
  }

  hydrate(state) {
    if (typeof this.room === 'string') {
      let room = state.RoomManager.getRoom(this.room);
      if (!room) {
        Logger.warn(`WARNING: Player ${this.name} was saved to invalid room ${this.room}.`);
        room = state.RoomManager.startingRoom;
      }

      this.room = room;
      room.addPlayer(this);
    }

    if (typeof this.account === 'string') {
      this.account = state.AccountManager.getAccount(this.account);
    }

    if (this.getMeta('class')) {
      this.playerClass = state.ClassManager.get(this.getMeta('class'));
    }

    // Hydrate inventory
    this.inventory.hydrate(state, this);

    // Hydrate equipment
    // maybe refactor Equipment to be an object like Inventory?
    if (this.equipment &amp;&amp; !(this.equipment instanceof Map)) {
      const eqDefs = this.equipment;
      this.equipment = new Map();
      for (const slot in eqDefs) {
        const itemDef = eqDefs[slot];
        let newItem = state.ItemFactory.create(state.AreaManager.getArea(itemDef.area), itemDef.entityReference);
        newItem.inventory = itemDef.inventory;
        newItem.hydrate(state);
        state.ItemManager.add(newItem);
        newItem.isEquipped = true;
        this.equip(newItem);
      }
    } else {
      this.equipment = new Map();
    }

    // Hydrate quests
    this.questTracker.hydrate(state);

    super.hydrate(state);
  }

  serialize() {
    let data = Object.assign(super.serialize(), {
      account: this.account.name,
      experience: this.experience,
      inventory: this.inventory &amp;&amp; this.inventory.serialize(),
      metadata: this.metadata,
      password: this.password,
      playerClass: this.playerClass &amp;&amp; this.playerClass.id,
      prompt: this.prompt,
      quests: this.questTracker.serialize(),
      role: this.role,
    });

    if (this.equipment) {
      let eq = {};
      for (let [ slot, item ] of this.equipment) {
        eq[slot] = item.serialize();
      }
      data.equipment = eq;
    } else {
      data.equipment = null;
    }

    return data;
  }

  /**
   * Used by Broadcaster
   * @return {Array&lt;Character>}
   */
  getBroadcastTargets() {
    return [this];
  }

  static validateName(name) {
    const maxLength = Config.get('maxPlayerNameLength');
    const minLength = Config.get('minPlayerNameLength');

    if (!name) {
      return 'Please enter a name.';
    }
    if (name.length > maxLength) {
      return 'Too long, try a shorter name.';
    }
    if (name.length &lt; minLength) {
      return 'Too short, try a longer name.';
    }
    if (!/^[a-z]+$/i.test(name)) {
      return 'Your name may only contain A-Z without spaces or special characters.';
    }
    return false;
  }
}

module.exports = Player;
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="../images/logo.png" style="width: 120px; height: 120px">
    <div class="footer-text">Copyright © 2017, Shawn Biddle</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
