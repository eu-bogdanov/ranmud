<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="../node_modules/d3/build/d3.min.js"></script>
    <meta charset="utf-8">
    <title>Leveling Charts</title>
  </head>
  <body>
    <h3>Experience needed by level</h3>
    <svg class="tnl-chart" width="1000" heigh="500"></svg>
    <h3>Attribute points earned by level</h3>
    <svg class="attr-chart" width="1000" heigh="500"></svg>
    <h3>Skill points earned by level</h3>
    <svg class="skill-chart" width="1000" heigh="500"></svg>
    <h3>Mutagens earned by level</h3>
    <svg class="mut-chart" width="1000" heigh="500"></svg>
    <h3>Cost in skill points per skill level</h3>
    <script>
      /**
       * These formulas are stolen straight from WoW.
       * See: http://www.wowwiki.com/Formulas:XP_To_Level
       */

      const reduction = level => {
        let val;
        switch (true) {
          case (level <= 10):
            val = 1;
            break;
          case (level >= 11 && level <= 27):
            val = 1 - (level - 10) / 100;
            break;
          case (level >= 28 && level <= 59):
            val = .82;
            break;
          default:
            val = 1;
        }
        return val;
      };

      /**
       * Difficulty modifier
       * @param int level
       * @return int
       */
      const diff = level => {
        switch (true) {
          case (level <= 5):
            return 0;
          case (level <= 10):
            return 2;
          case (level >= 15):
            return 4;
          case (level >= 20):
            return 6;
          case (level >= 32):
            return 5 + level - 30;
        }
      };

      /**
       * Get the exp that a mob gives
       * @param int level
       * @return int
       */
      const mobExp = level => 45 + (5 * level);

      /**
       * Get the amount of 'hours' a PC can train skills after levelup
       * @param int Player level
       * @return number of times they may train skills.
       */
      const getTrainingTime = level => Math.floor(level / 4 + 1);


      /**
       * Helper to get the amount of experience a player needs to level
       * @param int level Target level
       * @return int
       */
      const expToLevel = level =>
        ((2 * level) + diff(level)) * mobExp(level) * reduction(level);

      const fillArray = (n, v) => [...Array(parseInt(n, 10))].map(() => v);

      const maxLevel      = 60;
      const maxLevelArray = fillArray(maxLevel, {});
      const tnlChartData  = maxLevelArray
        .reduce((acc, _, index) => {
          const previous = acc[index];
          const cumulativeXPNeeded = previous.y + expToLevel(index + 1);
          return acc.concat({
            x: index + 1,
            y: cumulativeXPNeeded
          });
        }, [{ x: 0, y: 0 }]);

      console.log('TNL:', tnlChartData);

      const attrChartData = maxLevelArray
        .map((_, index) => ({ x: index + 1, y: index + 1 }));

      const skillChartData = maxLevelArray
        .reduce((acc, _, index) => {
          const previous = acc[index];
          const cumulativeTrainingTime = previous.y + getTrainingTime(index + 1);
          return acc.concat({
            x: index + 1,
            y: cumulativeTrainingTime
          });
        }, [{ x: 0, y: 0 }]);

      console.log('Skills:', skillChartData);

      const maxSkillLevel = 10;
      const skillGainChartData = fillArray(maxSkillLevel, {})
        .reduce((acc, _, index) => {
          const previous = acc[index];
          const cumulativeSkillPointsSpent = previous.x ?
            previous.y + index + 1 : 0;
          return acc.concat({
            x: index + 1,
            y: cumulativeSkillPointsSpent
          });
        }, [{ x: 0, y: 0 }]);
      console.log('SP spent to max skill: ', skillGainChartData);

    </script>

  </body>
</html>
